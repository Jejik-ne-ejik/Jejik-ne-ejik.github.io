<!DOCTYPE html>
<html>
<head>
    <title>Collectible Game</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script>
        // Счетчик очков
        let score = 0;
        let timer = 60; // Таймер на 60 секунд
        let gameActive = true;

        // Компонент для обработки столкновений
        AFRAME.registerComponent('collectible', {
            init: function () {
                this.el.addEventListener('collide', function (e) {
                    if (gameActive && e.detail.body.el.id === 'player') {
                        score++;
                        document.getElementById('score').setAttribute('value', 'Score: ' + score);
                        this.el.setAttribute('visible', false); // Убираем объект
                    }
                });
            }
        });

        // Функция для обновления таймера
        function updateTimer() {
            if (gameActive && timer > 0) {
                timer--;
                document.getElementById('timer').setAttribute('value', 'Time: ' + timer);
                setTimeout(updateTimer, 1000);
            } else if (timer === 0) {
                endGame();
            }
        }

        // Функция завершения игры
        function endGame() {
            gameActive = false;
            document.getElementById('end-message').setAttribute('visible', true);
            document.getElementById('final-score').setAttribute('value', 'Final Score: ' + score);
        }

        // Функция перезапуска игры
        function restartGame() {
            score = 0;
            timer = 60;
            gameActive = true;
            document.getElementById('score').setAttribute('value', 'Score: ' + score);
            document.getElementById('timer').setAttribute('value', 'Time: ' + timer);
            document.getElementById('end-message').setAttribute('visible', false);
            updateTimer();
            
            // Восстанавливаем видимость объектов
            const collectibles = document.querySelectorAll('.collectible');
            collectibles.forEach(function (item) {
                item.setAttribute('visible', true);
            });
        }

        window.onload = function () {
            updateTimer();
        };
    </script>
</head>
<body>
    <a-scene physics="debug: false">
        <a-entity id="player" position="0 1.6 -5" geometry="primitive: box" material="color: blue"></a-entity>

        <!-- Объекты для сбора -->
        <a-box class="collectible" position="-1 1 -3" color="red" collectible></a-box>
        <a-sphere class="collectible" position="1 1 -3" color="green" collectible></a-sphere>
        
        <!-- Текст для отображения счета и таймера -->
        <a-text id="score" value="Score: 0" position="-2 2 -4"></a-text>
        <a-text id="timer" value="Time: 60" position="-2 1.5 -4"></a-text>

        <!-- Сообщение о завершении игры -->
        <a-text id="end-message" value="" position="-2 0 -4" visible="false"></a-text>
        <a-text id="final-score" value="" position="-2 -0.5 -4" visible="false"></a-text>

        <!-- Кнопка перезапуска игры -->
        <a-entity geometry="primitive: plane; height: 0.5; width: 1"
                  material="color: yellow"
                  position="-2 -1 -4"
                  text="value: Restart; align: center"
                  event-set__mouseenter="_event: mouseenter; color: orange"
                  event-set__mouseleave="_event: mouseleave; color: yellow"
                  onclick="restartGame()"></a-entity>
    </a-scene>
</body>
</html>
